package com.app.controllers;

import com.app.entities.Bid;
import com.app.entities.Player;
import com.app.services.AuctionService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/auction")
public class AuctionController {

    @Autowired
    private AuctionService auctionService;

    /**
     * Places a bid for a player by a user.
     *
     * @param userId    the ID of the user placing the bid
     * @param playerId  the ID of the player being bid on
     * @param bidAmount the amount of the bid
     */
    @PostMapping("/bid")
    public void placeBid(
            @RequestParam Long userId,
            @RequestParam Long playerId,
            @RequestParam Double bidAmount) {
        auctionService.placeBid(userId, playerId, bidAmount);
    }

    /**
     * Retrieves the highest bid for a given player.
     *
     * @param playerId the ID of the player
     * @return the highest bid amount
     */
    @GetMapping("/highest-bid/{playerId}")
    public Double getCurrentHighestBid(@PathVariable Long playerId) {
        return auctionService.getCurrentHighestBid(playerId);
    }

    /**
     * Retrieves the user ID of the highest bidder for a given player.
     *
     * @param playerId the ID of the player
     * @return the ID of the highest bidder
     */
    @GetMapping("/highest-bidder/{playerId}")
    public Long getCurrentHighestBidder(@PathVariable Long playerId) {
        return auctionService.getCurrentHighestBidder(playerId);
    }

    /**
     * Finalizes the auction by processing the highest bids for all players.
     */
    @PostMapping("/finalize")
    public void finalizeAuction() {
        auctionService.finalizeAuction();
    }

    /**
     * Retrieves all players associated with a given team.
     *
     * @param teamId the ID of the team
     * @return a list of players associated with the team
     */
    @GetMapping("/team/{teamId}/players")
    public List<Player> getPlayersForTeam(@PathVariable Long teamId) {
        return auctionService.getPlayersForTeam(teamId);
    }
}
